<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 A text project, from start to topic model | Introduction to Computational Social Science</title>
  <meta name="description" content="10 A text project, from start to topic model | Introduction to Computational Social Science" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="10 A text project, from start to topic model | Introduction to Computational Social Science" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 A text project, from start to topic model | Introduction to Computational Social Science" />
  
  
  

<meta name="author" content="Mark Hoffman" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="machine-learning-with-caret.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="reading-list.html"><a href="reading-list.html"><i class="fa fa-check"></i><b>1</b> Reading List</a><ul>
<li class="chapter" data-level="1.1" data-path="reading-list.html"><a href="reading-list.html#readings-and-software"><i class="fa fa-check"></i><b>1.1</b> Readings and Software</a></li>
<li class="chapter" data-level="1.2" data-path="reading-list.html"><a href="reading-list.html#course-outline"><i class="fa fa-check"></i><b>1.2</b> Course Outline</a></li>
<li class="chapter" data-level="1.3" data-path="reading-list.html"><a href="reading-list.html#week-1-beg.-june-21st-introductions-lab-introduction-to-r"><i class="fa fa-check"></i><b>1.3</b> Week 1 (beg. June 21st): Introductions (Lab: Introduction to R)</a></li>
<li class="chapter" data-level="1.4" data-path="reading-list.html"><a href="reading-list.html#week-2-beg.-june-28th-ethics-lab-surveys-and-survey-experiments"><i class="fa fa-check"></i><b>1.4</b> Week 2 (beg. June 28th): Ethics (Lab: Surveys and Survey Experiments)</a></li>
<li class="chapter" data-level="1.5" data-path="reading-list.html"><a href="reading-list.html#week-3-beg.-july-5th-inequality-no-lab"><i class="fa fa-check"></i><b>1.5</b> Week 3 (beg. July 5th): Inequality (No Lab)</a></li>
<li class="chapter" data-level="1.6" data-path="reading-list.html"><a href="reading-list.html#week-4-beg.-july-12th-polarization-lab-collecting-data-online"><i class="fa fa-check"></i><b>1.6</b> Week 4 (beg. July 12th): Polarization (Lab: Collecting Data Online)</a></li>
<li class="chapter" data-level="1.7" data-path="reading-list.html"><a href="reading-list.html#week-5-beg.-july-19th-markets-lab-regression"><i class="fa fa-check"></i><b>1.7</b> Week 5 (beg. July 19th): Markets (Lab: Regression)</a></li>
<li class="chapter" data-level="1.8" data-path="reading-list.html"><a href="reading-list.html#week-6-beg.-july-26th-semantic-change-and-historical-meaning-lab-machine-learning"><i class="fa fa-check"></i><b>1.8</b> Week 6 (beg. July 26th): Semantic Change and Historical Meaning (Lab: Machine Learning)</a></li>
<li class="chapter" data-level="1.9" data-path="reading-list.html"><a href="reading-list.html#week-7-beg.-aug.2nd-discrimination-lab-text-analysis"><i class="fa fa-check"></i><b>1.9</b> Week 7 (beg. Aug. 2nd): Discrimination (Lab: Text Analysis)</a></li>
<li class="chapter" data-level="1.10" data-path="reading-list.html"><a href="reading-list.html#week-8-beg.-aug.9th-homophily-and-diffusion-lab-network-analysis"><i class="fa fa-check"></i><b>1.10</b> Week 8 (beg. Aug. 9th): Homophily and Diffusion (Lab: Network Analysis)</a></li>
<li class="chapter" data-level="1.11" data-path="reading-list.html"><a href="reading-list.html#week-9-beg.-aug.16th-health-no-lab"><i class="fa fa-check"></i><b>1.11</b> Week 9 (beg. Aug. 16th): Health (No Lab)</a></li>
<li class="chapter" data-level="1.12" data-path="reading-list.html"><a href="reading-list.html#week-10-beg.-aug.23rd-group-presentations"><i class="fa fa-check"></i><b>1.12</b> Week 10 (beg. Aug. 23rd): Group Presentations</a></li>
<li class="chapter" data-level="1.13" data-path="reading-list.html"><a href="reading-list.html#september-3rd-final-papers-are-due."><i class="fa fa-check"></i><b>1.13</b> September 3rd: Final papers are due.</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="installing-r-and-rstudio.html"><a href="installing-r-and-rstudio.html"><i class="fa fa-check"></i><b>2</b> Installing R and RStudio</a><ul>
<li class="chapter" data-level="2.1" data-path="installing-r-and-rstudio.html"><a href="installing-r-and-rstudio.html#downloading-and-installing-r"><i class="fa fa-check"></i><b>2.1</b> Downloading and Installing R</a></li>
<li class="chapter" data-level="2.2" data-path="installing-r-and-rstudio.html"><a href="installing-r-and-rstudio.html#downloading-and-installing-rstudio"><i class="fa fa-check"></i><b>2.2</b> Downloading and Installing RStudio</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tour-rstudio-with-udacity.html"><a href="tour-rstudio-with-udacity.html"><i class="fa fa-check"></i><b>3</b> Tour RStudio with Udacity</a></li>
<li class="chapter" data-level="4" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>4</b> R Basics</a><ul>
<li class="chapter" data-level="4.1" data-path="r-basics.html"><a href="r-basics.html#vectors"><i class="fa fa-check"></i><b>4.1</b> Vectors</a></li>
<li class="chapter" data-level="4.2" data-path="r-basics.html"><a href="r-basics.html#loading-packages"><i class="fa fa-check"></i><b>4.2</b> Loading Packages</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exploring-and-visualizing-data.html"><a href="exploring-and-visualizing-data.html"><i class="fa fa-check"></i><b>5</b> Exploring and Visualizing Data</a><ul>
<li class="chapter" data-level="5.1" data-path="exploring-and-visualizing-data.html"><a href="exploring-and-visualizing-data.html#lab-assignment"><i class="fa fa-check"></i><b>5.1</b> Lab Assignment</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="machine-learning-i-linear-and-multiple-regression.html"><a href="machine-learning-i-linear-and-multiple-regression.html"><i class="fa fa-check"></i><b>6</b> Machine Learning I: Linear and Multiple Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="machine-learning-i-linear-and-multiple-regression.html"><a href="machine-learning-i-linear-and-multiple-regression.html#more-with-the-gss"><i class="fa fa-check"></i><b>6.1</b> More with the GSS</a></li>
<li class="chapter" data-level="6.2" data-path="machine-learning-i-linear-and-multiple-regression.html"><a href="machine-learning-i-linear-and-multiple-regression.html#how-regression-works"><i class="fa fa-check"></i><b>6.2</b> How regression works</a></li>
<li class="chapter" data-level="6.3" data-path="machine-learning-i-linear-and-multiple-regression.html"><a href="machine-learning-i-linear-and-multiple-regression.html#linear-regression-using-the-lm-function"><i class="fa fa-check"></i><b>6.3</b> Linear regression using the lm function</a></li>
<li class="chapter" data-level="6.4" data-path="machine-learning-i-linear-and-multiple-regression.html"><a href="machine-learning-i-linear-and-multiple-regression.html#prediction-and-prediction-errors"><i class="fa fa-check"></i><b>6.4</b> Prediction and prediction errors</a></li>
<li class="chapter" data-level="6.5" data-path="machine-learning-i-linear-and-multiple-regression.html"><a href="machine-learning-i-linear-and-multiple-regression.html#multiple-regression"><i class="fa fa-check"></i><b>6.5</b> Multiple Regression</a></li>
<li class="chapter" data-level="6.6" data-path="machine-learning-i-linear-and-multiple-regression.html"><a href="machine-learning-i-linear-and-multiple-regression.html#prediction"><i class="fa fa-check"></i><b>6.6</b> Prediction</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html"><i class="fa fa-check"></i><b>7</b> Surveys and Survey Experiments with Qualtrics</a><ul>
<li class="chapter" data-level="7.1" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#creating-a-qualtrics-account"><i class="fa fa-check"></i><b>7.1</b> Creating a Qualtrics account</a></li>
<li class="chapter" data-level="7.2" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#building-a-survey"><i class="fa fa-check"></i><b>7.2</b> Building a survey</a></li>
<li class="chapter" data-level="7.3" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#survey-options"><i class="fa fa-check"></i><b>7.3</b> Survey options</a></li>
<li class="chapter" data-level="7.4" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#a-quick-survey-experiment"><i class="fa fa-check"></i><b>7.4</b> A quick survey experiment</a></li>
<li class="chapter" data-level="7.5" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#publish-and-distribute"><i class="fa fa-check"></i><b>7.5</b> Publish and Distribute</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="collecting-data-online.html"><a href="collecting-data-online.html"><i class="fa fa-check"></i><b>8</b> Collecting data online</a><ul>
<li class="chapter" data-level="8.1" data-path="collecting-data-online.html"><a href="collecting-data-online.html#scraping-the-web"><i class="fa fa-check"></i><b>8.1</b> Scraping the web</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="machine-learning-with-caret.html"><a href="machine-learning-with-caret.html"><i class="fa fa-check"></i><b>9</b> Machine Learning with caret</a><ul>
<li class="chapter" data-level="9.1" data-path="machine-learning-with-caret.html"><a href="machine-learning-with-caret.html#the-data"><i class="fa fa-check"></i><b>9.1</b> The data</a></li>
<li class="chapter" data-level="9.2" data-path="machine-learning-with-caret.html"><a href="machine-learning-with-caret.html#training-vs.testing"><i class="fa fa-check"></i><b>9.2</b> Training vs. testing</a></li>
<li class="chapter" data-level="9.3" data-path="machine-learning-with-caret.html"><a href="machine-learning-with-caret.html#creating-features"><i class="fa fa-check"></i><b>9.3</b> Creating features</a></li>
<li class="chapter" data-level="9.4" data-path="machine-learning-with-caret.html"><a href="machine-learning-with-caret.html#constructing-a-model"><i class="fa fa-check"></i><b>9.4</b> Constructing a model</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="a-text-project-from-start-to-topic-model.html"><a href="a-text-project-from-start-to-topic-model.html"><i class="fa fa-check"></i><b>10</b> A text project, from start to topic model</a><ul>
<li class="chapter" data-level="10.0.1" data-path="a-text-project-from-start-to-topic-model.html"><a href="a-text-project-from-start-to-topic-model.html#lab"><i class="fa fa-check"></i><b>10.0.1</b> LAB</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Computational Social Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="a-text-project-from-start-to-topic-model" class="section level1">
<h1><span class="header-section-number">10</span> A text project, from start to topic model</h1>
<p>In this tutorial, we focus on a new analysis strategy for text - topic modeling. We download all of the pages on Wikipedia for famous philosophers, from Aristotle to Bruno Latour. Each page discusses their lives and works and we topic model the text in order to identify shared themes across them.</p>
<p>To do this, we first need to load in a bunch of packages. If you are missing one of these packages - if you get the error message “Error in library(tm) : there is no package called ‘tm’”, for example - then you should use install.packages() to install it.</p>
<p>In particular, there are three packages we have never seen before: stringi, which is useful for manipulating strings (we will use it to convert non-latin script to latin script), tm, which is a suite of functions for text mining in R, and texclean, which has useful functions for cleaning text.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb162-2" data-line-number="2"><span class="kw">library</span>(tidytext)</a>
<a class="sourceLine" id="cb162-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb162-4" data-line-number="4"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb162-5" data-line-number="5"><span class="kw">library</span>(stringi)</a>
<a class="sourceLine" id="cb162-6" data-line-number="6"><span class="kw">library</span>(tm)</a>
<a class="sourceLine" id="cb162-7" data-line-number="7"><span class="kw">library</span>(textclean)</a></code></pre></div>
<p>Most of the real scraping work I left out of the tutorial for the sake of time. But I followed, more or less, what we learned in the week on scraping. I found a page a series of pages which list philosophers alphabetically. I visited those pages and saw that they contained links to every Wikipedia page for a well-known philosopher. I used Inspect to copy the Xpath for a couple of these links and found that they followed a similar pattern - each was nested in the HTML structure underneath the pathway //*[@id=“mw-content-text”]/div/ul/li/a. I extracted the set of nodes which followed that path and grabbed the href (HTML lingo for a url) from each. The result was a list of Wikipedia short links for philosophers. I pasted the main wikipedia URL to precede short links. I also grabbed the titles of the nodes, which was the names of the philosophers. I used lapply to apply this function to each of the four pages, saved the results for each in a data.frame, and used do.call(“rbind”) to put all of them into a single data.frame.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1">grab_urls &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb163-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb163-3" data-line-number="3">  <span class="co"># id the url locations on the page (identified using Inspect and XPath)</span></a>
<a class="sourceLine" id="cb163-4" data-line-number="4">  philosophers_urls &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(x, <span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;mw-content-text&quot;]/div/ul/li/a&#39;</span>) </a>
<a class="sourceLine" id="cb163-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb163-6" data-line-number="6">  <span class="co"># extract the URL specifically</span></a>
<a class="sourceLine" id="cb163-7" data-line-number="7">  href_links &lt;-<span class="st"> </span>philosophers_urls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&#39;href&#39;</span>)</a>
<a class="sourceLine" id="cb163-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb163-9" data-line-number="9">  <span class="co"># paste the url ending to wikipedia English main url</span></a>
<a class="sourceLine" id="cb163-10" data-line-number="10">  urls &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://en.wikipedia.org/&quot;</span>, href_links)</a>
<a class="sourceLine" id="cb163-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb163-12" data-line-number="12">  <span class="co"># extract each philosopher&#39;s name</span></a>
<a class="sourceLine" id="cb163-13" data-line-number="13">  philosopher_names &lt;-<span class="st"> </span>philosophers_urls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&#39;title&#39;</span>)</a>
<a class="sourceLine" id="cb163-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb163-15" data-line-number="15">  <span class="co"># save the result in a data.frame</span></a>
<a class="sourceLine" id="cb163-16" data-line-number="16">  df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Philosopher =</span> philosopher_names, <span class="dt">URL =</span> urls, <span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb163-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb163-18" data-line-number="18">  <span class="co"># output the data.frame</span></a>
<a class="sourceLine" id="cb163-19" data-line-number="19">  <span class="kw">return</span>(df)</a>
<a class="sourceLine" id="cb163-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb163-21" data-line-number="21"></a>
<a class="sourceLine" id="cb163-22" data-line-number="22"><span class="co"># download html for each of the main philosopher pages from wikipedia</span></a>
<a class="sourceLine" id="cb163-23" data-line-number="23">philosophers_A_C &lt;-<span class="st">  </span><span class="kw">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/List_of_philosophers_(A–C)&quot;</span>)</a>
<a class="sourceLine" id="cb163-24" data-line-number="24">philosophers_D_H &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/List_of_philosophers_(D–H)&quot;</span>)</a>
<a class="sourceLine" id="cb163-25" data-line-number="25">philosophers_I_Q &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/List_of_philosophers_(I–Q)&quot;</span>)</a>
<a class="sourceLine" id="cb163-26" data-line-number="26">philosophers_R_Z &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/List_of_philosophers_(R–Z)&quot;</span>)</a>
<a class="sourceLine" id="cb163-27" data-line-number="27"></a>
<a class="sourceLine" id="cb163-28" data-line-number="28"><span class="co"># apply the above code to each of the pages</span></a>
<a class="sourceLine" id="cb163-29" data-line-number="29">all_dfs &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">list</span>(philosophers_A_C, philosophers_D_H, philosophers_I_Q, philosophers_R_Z), grab_urls)</a>
<a class="sourceLine" id="cb163-30" data-line-number="30"></a>
<a class="sourceLine" id="cb163-31" data-line-number="31"><span class="co"># put it all together </span></a>
<a class="sourceLine" id="cb163-32" data-line-number="32">all_philosophers &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, all_dfs)</a></code></pre></div>
<p>Let’s take a look. The data.frame has two columns - Philosopher and URL. We can use this information to now go to each of the philosopher’s pages and grab the content of their Wikipedia page.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1"><span class="kw">View</span>(all_philosophers)</a></code></pre></div>
<p>So now I write a new function which grabs the text from each page. It takes as its argument a URL. The HTML of this URL is read into R using rvest’s read_html. Then the body of the page - identified by //*[@id=“mw-content-text”]/div/p - is read into R and its text is extracted. This text is returned.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1">grab_text &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb165-2" data-line-number="2">    philosopher_html &lt;-<span class="st"> </span><span class="kw">read_html</span>(x)</a>
<a class="sourceLine" id="cb165-3" data-line-number="3">    philosopher_text &lt;-<span class="st"> </span>philosopher_html <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb165-4" data-line-number="4"><span class="st">      </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;mw-content-text&quot;]/div/p&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb165-5" data-line-number="5"><span class="st">      </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb165-6" data-line-number="6">  <span class="kw">return</span>(philosopher_text)</a>
<a class="sourceLine" id="cb165-7" data-line-number="7">}</a></code></pre></div>
<p>I apply it, again using lapply, to every URL in the all_philosophers data.frame. The result is the text of every philosopher’s page on Wikipedia. The only problem is it takes a while to run, especially if your computer isn’t fast.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">philosophers_page_text &lt;-<span class="st"> </span><span class="kw">lapply</span>(all_philosophers<span class="op">$</span>URL, <span class="cf">function</span>(x) <span class="kw">try</span>(<span class="kw">grab_text</span>(x)))</a></code></pre></div>
<p>I actually saved the results into an RDS file and put them on Canvas, so that you wouldn’t have to run this full loop (though you can if you are curious.) Download philosophers_page_text.RDS, drag it into your R directory, and load it in using readRDS, like so.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1">philosophers_page_text &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;philosophers_page_text_new.RDS&quot;</span>)</a></code></pre></div>
<p>So the texts are quite messy and we need to clean them before we can analyze them (though with topic modeling, this isn’t strictly necessary since it will often lump all of the junk into its own topic.) We build a function to do that. It uses repeated gsubs to remove characters that we don’t want from the text. If you don’t really understand what is going on here, then it is worth reading up on regex - it is an essential framework for working with text. Once the text is cleaned, we put all of the sentences for each philosopher into a single character vector and make it lowercase. Finally, we convert the list of texts to a character vector</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">clean_text &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb168-2" data-line-number="2">  <span class="co"># remove all parentheses and their content</span></a>
<a class="sourceLine" id="cb168-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">([^</span><span class="ch">\\</span><span class="st">)]+</span><span class="ch">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>, x)</a>
<a class="sourceLine" id="cb168-4" data-line-number="4">  <span class="co"># remove all square brackets and their content</span></a>
<a class="sourceLine" id="cb168-5" data-line-number="5">  x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">[[^][]*]&quot;</span>, <span class="st">&quot;&quot;</span>, x)</a>
<a class="sourceLine" id="cb168-6" data-line-number="6">  <span class="co"># remove all punctuation</span></a>
<a class="sourceLine" id="cb168-7" data-line-number="7">  x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;[[:punct:] ]+&#39;</span>,<span class="st">&#39; &#39;</span>,x)</a>
<a class="sourceLine" id="cb168-8" data-line-number="8">  <span class="co"># remove all numbers</span></a>
<a class="sourceLine" id="cb168-9" data-line-number="9">  x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;[[:digit:]]+&#39;</span>, <span class="st">&#39;&#39;</span>, x)</a>
<a class="sourceLine" id="cb168-10" data-line-number="10">  <span class="co"># drop paragraph breaks</span></a>
<a class="sourceLine" id="cb168-11" data-line-number="11">  x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="st">&#39;&#39;</span>, x)</a>
<a class="sourceLine" id="cb168-12" data-line-number="12">  <span class="co"># drop empty lines</span></a>
<a class="sourceLine" id="cb168-13" data-line-number="13">  x &lt;-<span class="st"> </span><span class="kw">subset</span>(x, x <span class="op">!=</span><span class="st"> &quot;&quot;</span>)</a>
<a class="sourceLine" id="cb168-14" data-line-number="14">  <span class="co"># remove spaces at beginning and end of lines</span></a>
<a class="sourceLine" id="cb168-15" data-line-number="15">  x &lt;-<span class="st"> </span><span class="kw">trimws</span>(x)</a>
<a class="sourceLine" id="cb168-16" data-line-number="16">  <span class="co"># paste all of the lines together into one text</span></a>
<a class="sourceLine" id="cb168-17" data-line-number="17">  x &lt;-<span class="st"> </span><span class="kw">paste0</span>(x, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb168-18" data-line-number="18">  <span class="co"># make everything lower case</span></a>
<a class="sourceLine" id="cb168-19" data-line-number="19">  x &lt;-<span class="st"> </span><span class="kw">tolower</span>(x)</a>
<a class="sourceLine" id="cb168-20" data-line-number="20">  <span class="co"># return text</span></a>
<a class="sourceLine" id="cb168-21" data-line-number="21">  <span class="kw">return</span>(x)</a>
<a class="sourceLine" id="cb168-22" data-line-number="22">}</a>
<a class="sourceLine" id="cb168-23" data-line-number="23"></a>
<a class="sourceLine" id="cb168-24" data-line-number="24">philosophers_texts_cleaned &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(philosophers_page_text, clean_text))</a></code></pre></div>
<p>Now we can add the texts into the data.frame of philosophers and their URLs. We can also drop the philosophers whose name was on Wikipedia but who don’t actually have a page. They can be identified by the fact that their text equals “error in open connection http error”.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1"><span class="co"># convert non-latin script to latin, if no easy conversion, then substite for empty string (i.e. delete)</span></a>
<a class="sourceLine" id="cb169-2" data-line-number="2">philosophers_texts_cleaned &lt;-<span class="st"> </span><span class="kw">iconv</span>(<span class="kw">stri_trans_general</span>(philosophers_texts_cleaned, <span class="st">&quot;latin-ascii&quot;</span>), <span class="st">&quot;latin1&quot;</span>, <span class="st">&quot;ASCII&quot;</span>, <span class="dt">sub=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb169-3" data-line-number="3">philosophers_texts_cleaned &lt;-<span class="st"> </span><span class="kw">replace_non_ascii</span>(philosophers_texts_cleaned)</a>
<a class="sourceLine" id="cb169-4" data-line-number="4">good_texts &lt;-<span class="st"> </span><span class="kw">which</span>(philosophers_texts_cleaned<span class="op">!=</span><span class="st"> &quot;error in open connection http error&quot;</span>)</a>
<a class="sourceLine" id="cb169-5" data-line-number="5"></a>
<a class="sourceLine" id="cb169-6" data-line-number="6">all_philosophers &lt;-<span class="st"> </span>all_philosophers[good_texts,]</a>
<a class="sourceLine" id="cb169-7" data-line-number="7">all_philosophers<span class="op">$</span>Text &lt;-<span class="st"> </span>philosophers_texts_cleaned[good_texts]</a></code></pre></div>
<p>Now we have to do some more cleaning. We can turn this data set into a tokenized tidytext data set with the unnest_tokens function.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1"><span class="co"># further cleaning...</span></a>
<a class="sourceLine" id="cb170-2" data-line-number="2"><span class="co"># tokenize the result</span></a>
<a class="sourceLine" id="cb170-3" data-line-number="3">text_cleaning_tokens &lt;-<span class="st"> </span>all_philosophers <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest_tokens</span>(word, Text)</a></code></pre></div>
<p>Next we want to drop words which are less than three characters in length, and drop stop words. We can drop short words with filter combined with the nchar function, and anti_join to drop stopwords.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1"><span class="co"># drop words with are either stop words or length == 1</span></a>
<a class="sourceLine" id="cb171-2" data-line-number="2">text_cleaning_tokens &lt;-<span class="st"> </span>text_cleaning_tokens <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>(<span class="kw">nchar</span>(word) <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-4" data-line-number="4"><span class="st">  </span><span class="kw">anti_join</span>(stop_words)</a></code></pre></div>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<p>Next we drop empty words</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1"><span class="co"># filter out empty words</span></a>
<a class="sourceLine" id="cb173-2" data-line-number="2">tokens &lt;-<span class="st"> </span>text_cleaning_tokens <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>(word<span class="op">==</span><span class="st">&quot;&quot;</span>))</a></code></pre></div>
<p>The next part is a bit complicated. The basic idea is that we want to paste the texts for each philosopher back together. The unite function is good for that, but it only works on a wide form data set. So we will first group by philosopher, produce an index for the row number (that is, what position is a given word in their text), we will then spread the data, converting our long form data into wide form, setting the key argument (which defines the columns of the new data.frame) to equal the index we created, and the value argument to word. The result is that each book is now its own row in the data.frame, with the column i+2 identifying the ith word in that philosopher’s Wikipedia page.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1"><span class="co"># turn each person into a row, with a column for each word in their wikipedia</span></a>
<a class="sourceLine" id="cb174-2" data-line-number="2">tokens &lt;-<span class="st"> </span>tokens <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Philosopher) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb174-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ind =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb174-4" data-line-number="4"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> ind, <span class="dt">value =</span> word)</a></code></pre></div>
<p>We’ll convert NAs to &quot;&quot; and use unite to paste all of the columns in the data.frame together. We specify -Philosopher and -URL so that those columns are preserved and not pasted with the words of each page.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1"><span class="co"># convert NAs to empty strings</span></a>
<a class="sourceLine" id="cb175-2" data-line-number="2">tokens[<span class="kw">is.na</span>(tokens)] &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb175-3" data-line-number="3"></a>
<a class="sourceLine" id="cb175-4" data-line-number="4"><span class="co"># put the data.frame back together</span></a>
<a class="sourceLine" id="cb175-5" data-line-number="5">tokens &lt;-<span class="st"> </span><span class="kw">unite</span>(tokens, Text,<span class="op">-</span>Philosopher, <span class="op">-</span>URL, <span class="dt">sep =</span><span class="st">&quot; &quot;</span> )</a></code></pre></div>
<p>Two last things are necessary before we analyze the data. We need to trim whitespace, so that there aren’t spaces at the beginning or end of texts. And we need to convert non-latin characters to latin characters (using the stri_trans_general() function from stringi) or else, if they can’t be converted, drop them (using the iconv() function from base R.)</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1"><span class="co"># trim white space</span></a>
<a class="sourceLine" id="cb176-2" data-line-number="2">tokens<span class="op">$</span>Text &lt;-<span class="st"> </span><span class="kw">trimws</span>(tokens<span class="op">$</span>Text)</a></code></pre></div>
<p>Great! Let’s check out the data.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="kw">View</span>(tokens)</a></code></pre></div>
<p>Topic modeling requires a document to word matrix. In such a matrix, each row is a document, each column is a word, and each cell or value in the matrix is a count of how many times a given document uses a given word. To get to such a matrix, we first need to count how many times each word appears on each philosopher’s page. We learned how to do this last tutorial.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1">token_counts &lt;-<span class="st"> </span>tokens <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb178-2" data-line-number="2"><span class="st">  </span><span class="kw">unnest_tokens</span>(word, Text) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb178-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(Philosopher, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Now we can use a function called cast_dtm from the tm package to convert token_counts into a document-to-word matrix (dtm stands for document-to-term, actually.) We tell it - the variable in token_counts we want to use for the rows of the dtm (Philosopher), the variable we want to use as the column (word), and the variable that should fill the matrix as values (n).</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" data-line-number="1">philosopher_dtm &lt;-<span class="st"> </span>token_counts <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb179-2" data-line-number="2"><span class="st">  </span><span class="kw">cast_dtm</span>(Philosopher, word, n)</a></code></pre></div>
<p>Awesome! You can View what it looks like if you want. We can use this dtm to fit a topic model using latent dirichlet allocation (LDA) from the topicmodels package. We have a few options when doing so - first we will set k, the number of topics to equal 20. If we were doing this for a real study (like your final project), we would want to fit a couple of different models with different ks to see how the results change and to try to find the model with the best fit. For now, we will settle for just trying k = 20. We can also set the seed directly inside the function so that we are certain to all get the same results.</p>
<p>This might take a while!</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1"><span class="kw">library</span>(topicmodels)</a></code></pre></div>
<pre><code>## Warning: package &#39;topicmodels&#39; was built under R version 3.6.2</code></pre>
<pre><code>## 
## Attaching package: &#39;topicmodels&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:text2vec&#39;:
## 
##     perplexity</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1">philosophers_lda &lt;-<span class="st"> </span><span class="kw">LDA</span>(philosopher_dtm, <span class="dt">k =</span> <span class="dv">20</span>, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">seed =</span> <span class="dv">1234</span>))</a></code></pre></div>
<p>It finished running - now what? We can use the tidy function from the tidyr package to extract some useful information. First, let’s extract the beta coefficients - which provides weights for the words with respect to topics.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">philosophers_lda_td &lt;-<span class="st"> </span><span class="kw">tidy</span>(philosophers_lda, <span class="dt">matrix =</span> <span class="st">&quot;beta&quot;</span>)</a></code></pre></div>
<p>Just like we did last class, let’s use top_n to grab the top 10 words per topic.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1">top_terms &lt;-<span class="st"> </span>philosophers_lda_td <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(topic) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-3" data-line-number="3"><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">10</span>, beta) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-4" data-line-number="4"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(topic, <span class="op">-</span>beta)</a></code></pre></div>
<p>We can plot the results using ggplot as a series of bar plots</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb187-2" data-line-number="2"></a>
<a class="sourceLine" id="cb187-3" data-line-number="3">top_terms <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">reorder_within</span>(term, beta, topic)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(term, beta)) <span class="op">+</span></a>
<a class="sourceLine" id="cb187-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb187-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_reordered</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb187-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>topic, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb187-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<p>Or else as a table.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">top_terms_table &lt;-<span class="st"> </span>top_terms <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(topic) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">order =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(topic)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>beta) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-5" data-line-number="5"><span class="st">  </span><span class="kw">spread</span>(topic, term) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>order) </a></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-106">Table 10.1: </span>Top 10 terms per topic</caption>
<thead>
<tr class="header">
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
<th align="left">5</th>
<th align="left">6</th>
<th align="left">7</th>
<th align="left">8</th>
<th align="left">9</th>
<th align="left">10</th>
<th align="left">11</th>
<th align="left">12</th>
<th align="left">13</th>
<th align="left">14</th>
<th align="left">15</th>
<th align="left">16</th>
<th align="left">17</th>
<th align="left">18</th>
<th align="left">19</th>
<th align="left">20</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">psychology</td>
<td align="left">philosophy</td>
<td align="left">wittgenstein</td>
<td align="left">law</td>
<td align="left">plato</td>
<td align="left">king</td>
<td align="left">political</td>
<td align="left">french</td>
<td align="left">university</td>
<td align="left">ibn</td>
<td align="left">german</td>
<td align="left">church</td>
<td align="left">mao</td>
<td align="left">parser</td>
<td align="left">philosophy</td>
<td align="left">chamberlain</td>
<td align="left">john</td>
<td align="left">god</td>
<td align="left">darwin</td>
<td align="left">law</td>
</tr>
<tr class="even">
<td align="left">university</td>
<td align="left">french</td>
<td align="left">philosophy</td>
<td align="left">guevara</td>
<td align="left">life</td>
<td align="left">burke</td>
<td align="left">party</td>
<td align="left">rousseau</td>
<td align="left">philosophy</td>
<td align="left">jewish</td>
<td align="left">published</td>
<td align="left">god</td>
<td align="left">chinese</td>
<td align="left">output</td>
<td align="left">theory</td>
<td align="left">eliade</td>
<td align="left">smith</td>
<td align="left">church</td>
<td align="left">reich</td>
<td align="left">buddha</td>
</tr>
<tr class="odd">
<td align="left">priestley</td>
<td align="left">heidegger</td>
<td align="left">shankara</td>
<td align="left">bacon</td>
<td align="left">greek</td>
<td align="left">hume</td>
<td align="left">government</td>
<td align="left">voltaire</td>
<td align="left">professor</td>
<td align="left">god</td>
<td align="left">philosophy</td>
<td align="left">john</td>
<td align="left">gandhi</td>
<td align="left">socrates</td>
<td align="left">logic</td>
<td align="left">time</td>
<td align="left">published</td>
<td align="left">christian</td>
<td align="left">time</td>
<td align="left">foucault</td>
</tr>
<tr class="even">
<td align="left">peirce</td>
<td align="left">freud</td>
<td align="left">russell</td>
<td align="left">hayek</td>
<td align="left">aristotle</td>
<td align="left">kafka</td>
<td align="left">stalin</td>
<td align="left">published</td>
<td align="left">college</td>
<td align="left">islamic</td>
<td align="left">hegel</td>
<td align="left">pope</td>
<td align="left">china</td>
<td align="left">background</td>
<td align="left">social</td>
<td align="left">leibniz</td>
<td align="left">church</td>
<td align="left">origen</td>
<td align="left">wallace</td>
<td align="left">kant</td>
</tr>
<tr class="odd">
<td align="left">wundt</td>
<td align="left">world</td>
<td align="left">gibbs</td>
<td align="left">published</td>
<td align="left">diogenes</td>
<td align="left">steiner</td>
<td align="left">marx</td>
<td align="left">paris</td>
<td align="left">theory</td>
<td align="left">philosophy</td>
<td align="left">time</td>
<td align="left">thomas</td>
<td align="left">sun</td>
<td align="left">lock</td>
<td align="left">science</td>
<td align="left">newton</td>
<td align="left">william</td>
<td align="left">life</td>
<td align="left">adorno</td>
<td align="left">theory</td>
</tr>
<tr class="even">
<td align="left">arendt</td>
<td align="left">university</td>
<td align="left">school</td>
<td align="left">linnaeus</td>
<td align="left">philosophy</td>
<td align="left">schopenhauer</td>
<td align="left">war</td>
<td align="left">time</td>
<td align="left">philosopher</td>
<td align="left">arabic</td>
<td align="left">friedrich</td>
<td align="left">aristotle</td>
<td align="left">people</td>
<td align="left">gray</td>
<td align="left">world</td>
<td align="left">galileo</td>
<td align="left">wrote</td>
<td align="left">gregory</td>
<td align="left">published</td>
<td align="left">legal</td>
</tr>
<tr class="odd">
<td align="left">philosophy</td>
<td align="left">published</td>
<td align="left">time</td>
<td align="left">time</td>
<td align="left">time</td>
<td align="left">world</td>
<td align="left">soviet</td>
<td align="left">france</td>
<td align="left">oxford</td>
<td align="left">time</td>
<td align="left">goethe</td>
<td align="left">luther</td>
<td align="left">government</td>
<td align="left">fondane</td>
<td align="left">mind</td>
<td align="left">gobineau</td>
<td align="left">time</td>
<td align="left">kierkegaard</td>
<td align="left">wrote</td>
<td align="left">buddhist</td>
</tr>
<tr class="even">
<td align="left">published</td>
<td align="left">derrida</td>
<td align="left">university</td>
<td align="left">university</td>
<td align="left">world</td>
<td align="left">published</td>
<td align="left">revolution</td>
<td align="left">wrote</td>
<td align="left">published</td>
<td align="left">taymiyyah</td>
<td align="left">wrote</td>
<td align="left">theology</td>
<td align="left">political</td>
<td align="left">turing</td>
<td align="left">knowledge</td>
<td align="left">wrote</td>
<td align="left">college</td>
<td align="left">theology</td>
<td align="left">evolution</td>
<td align="left">kelsen</td>
</tr>
<tr class="odd">
<td align="left">chomsky</td>
<td align="left">husserl</td>
<td align="left">god</td>
<td align="left">erasmus</td>
<td align="left">blake</td>
<td align="left">time</td>
<td align="left">lenin</td>
<td align="left">book</td>
<td align="left">school</td>
<td align="left">wrote</td>
<td align="left">germany</td>
<td align="left">time</td>
<td align="left">life</td>
<td align="left">citation</td>
<td align="left">university</td>
<td align="left">kepler</td>
<td align="left">england</td>
<td align="left">augustine</td>
<td align="left">huxley</td>
<td align="left">jung</td>
</tr>
<tr class="even">
<td align="left">research</td>
<td align="left">theory</td>
<td align="left">life</td>
<td align="left">wrote</td>
<td align="left">pythagoras</td>
<td align="left">life</td>
<td align="left">social</td>
<td align="left">diderot</td>
<td align="left">science</td>
<td align="left">maimonides</td>
<td align="left">life</td>
<td align="left">century</td>
<td align="left">han</td>
<td align="left">published</td>
<td align="left">human</td>
<td align="left">descartes</td>
<td align="left">english</td>
<td align="left">christ</td>
<td align="left">natural</td>
<td align="left">time</td>
</tr>
</tbody>
</table>
<p>What if want to look at the extent to which each document or philosopher is composed of each topic? We can instead set matrix = “gamma” to get the gamma values, which tell you exactly that.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">philosophers_lda_gamma &lt;-<span class="st"> </span><span class="kw">tidy</span>(philosophers_lda, <span class="dt">matrix =</span> <span class="st">&quot;gamma&quot;</span>)</a></code></pre></div>
<p>We’ll sort in descending order according to gamma</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">top_topics &lt;-<span class="st"> </span>philosophers_lda_gamma <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(document, <span class="op">-</span>gamma)</a></code></pre></div>
<p>There are a bunch of philosophers, too many to examine all at once. Let’s select a few particularly prominent ones and examine their topic distributions.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1">selected_philosophers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Martin Luther King, Jr.&quot;</span>, </a>
<a class="sourceLine" id="cb191-2" data-line-number="2">  <span class="st">&quot;Francis Bacon&quot;</span>, </a>
<a class="sourceLine" id="cb191-3" data-line-number="3">  <span class="st">&quot;Wang Fuzhi&quot;</span>, </a>
<a class="sourceLine" id="cb191-4" data-line-number="4">  <span class="st">&quot;Aristotle&quot;</span>, </a>
<a class="sourceLine" id="cb191-5" data-line-number="5">  <span class="st">&quot;Immanuel Kant&quot;</span>, </a>
<a class="sourceLine" id="cb191-6" data-line-number="6">  <span class="st">&quot;Pope John XXI&quot;</span>, </a>
<a class="sourceLine" id="cb191-7" data-line-number="7">  <span class="st">&quot;Friedrich Kayek&quot;</span>, </a>
<a class="sourceLine" id="cb191-8" data-line-number="8">  <span class="st">&quot;Edmund Burke&quot;</span>, </a>
<a class="sourceLine" id="cb191-9" data-line-number="9">  <span class="st">&quot;Simone de Beauvoir&quot;</span>, </a>
<a class="sourceLine" id="cb191-10" data-line-number="10">  <span class="st">&quot;Bruno Latour&quot;</span>)</a>
<a class="sourceLine" id="cb191-11" data-line-number="11"></a>
<a class="sourceLine" id="cb191-12" data-line-number="12">top_topics <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(document <span class="op">%in%</span><span class="st"> </span>selected_philosophers) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(topic, gamma)) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="dv">1</span><span class="op">:</span><span class="dv">20</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>document, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-18" data-line-number="18"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-109-1.png" width="672" /></p>
<div id="lab" class="section level3">
<h3><span class="header-section-number">10.0.1</span> LAB</h3>
<p>For the lab this week, select or randomly sample 100 texts from the Gutenberg library and topic model the texts with a k of your choosing.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="machine-learning-with-caret.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
